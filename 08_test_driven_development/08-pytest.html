
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>useful resources: &#8212; learn-python</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="08-unittest_mock.html" />
    <link rel="prev" title="Design patterns in python" href="../07_design_patterns_in_python/07-design_patterns_in_python.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">learn-python</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../content.html">
   Content in Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to your Jupyter Book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown.html">
   Markdown Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks.html">
   Content with notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02_closures_and_decorators/closure_and_decorators.html">
   Closures and decorators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02_closures_and_decorators/closure_and_decorators.html#your-turn">
   Your Turn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_polymorphism_protocols_and_abcs/polymorphism_protocols_abcs.html">
   Abstract Base Classes (ABCs)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_polymorphism_protocols_and_abcs/polymorphism_protocols_abcs.html#summary">
   Summary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_writing_our_own_container_types/writing_our_own_container_types.html">
   Creating new collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_writing_our_own_container_types/writing_our_own_container_types.html#iterator-protocol">
   Iterator protocol
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06_multiple_inheritance_and_super/multiple_inheritance_and_super.html">
   super() and multiple inheritance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_design_patterns_in_python/07-design_patterns_in_python.html">
   Design patterns in python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_design_patterns_in_python/07-design_patterns_in_python.html#prototype">
   Prototype
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_design_patterns_in_python/07-design_patterns_in_python.html#singleton">
   Singleton
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_design_patterns_in_python/07-design_patterns_in_python.html#proxy">
   Proxy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_design_patterns_in_python/07-design_patterns_in_python.html#composition">
   Composition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_design_patterns_in_python/07-design_patterns_in_python.html#resource-acquisition-is-initialization-raii">
   Resource Acquisition Is Initialization (RAII)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   useful resources:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#setup">
   setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#how-pytest-discovers-tests">
   How pytest discovers tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#our-first-test">
   our first test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#pytest-context-sensitive-comparisons">
   Pytest context-sensitive comparisons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#using-fixtures-to-simplify-tests">
   Using fixtures to simplify tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#parameterizing-fixtures">
   parameterizing fixtures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#printing-and-logging-within-tests">
   printing and logging within tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#float-when-things-are-almost-equal">
   float: when things are (almost) equal
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#adding-timeouts-to-tests">
   adding timeouts to tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#testing-for-exceptions">
   testing for exceptions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#running-tests-in-parallel">
   running tests in parallel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#codebase-to-test-class-person">
   Codebase to test: class Person
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#id14">
   our first test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10_package_management/10-package_management.html">
   Where are my packages?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10_package_management/10-package_management.html#development-of-projects-with-different-dependencies">
   Development of Projects with Different Dependencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11_db_access/01_basic_db_access.html">
   sqlite
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11_db_access/01_basic_db_access.html#pyodbc">
   pyodbc
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../12_its_fun_to_be_eval/its_fun_to_be_eval.html">
   Its fun to be eval
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../13_complex_comprehensions/complex_comprehensions.html">
   writing and understanding nested list comprehensions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../14_pandas/edm_us_adult_census_income/questions.html">
   get the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../14_pandas/edm_us_adult_census_income/questions.html#income-for-adults-from-the-1994-census">
   income for adults from the 1994 census
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/08_test_driven_development/08-pytest.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/08_test_driven_development/08-pytest.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/08_test_driven_development/08-pytest.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   useful resources:
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-pytest-discovers-tests">
   How pytest discovers tests
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#our-first-test">
   our first test
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#your-turn">
     your turn
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-context-sensitive-comparisons">
   Pytest context-sensitive comparisons
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     your turn
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-fixtures-to-simplify-tests">
   Using fixtures to simplify tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#motivating-example">
     Motivating example
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixtures-to-the-rescue">
     Fixtures to the rescue
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     your turn
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameterizing-fixtures">
   parameterizing fixtures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     your turn
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#printing-and-logging-within-tests">
   printing and logging within tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#printing">
     printing
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#logging">
     logging
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     your turn
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#float-when-things-are-almost-equal">
   float: when things are (almost) equal
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     your turn
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-timeouts-to-tests">
   adding timeouts to tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     your turn
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-for-exceptions">
   testing for exceptions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     your turn
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#hints">
       hints:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-tests-in-parallel">
   running tests in parallel
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#codebase-to-test-class-person">
   Codebase to test: class Person
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id14">
   our first test
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lets-run-our-tests">
     lets run our tests
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-our-first-test">
     running our first test
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <a href="https://colab.research.google.com/github/aviadr1/learn-advanced-python/blob/master/content/08_test_driven_development/08-pytest.ipynb" target="_blank">
<img src="https://colab.research.google.com/assets/colab-badge.svg" 
     title="Open this file in Google Colab" alt="Colab"/>
</a>
<div class="section" id="useful-resources">
<h1>useful resources:<a class="headerlink" href="#useful-resources" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>https://stackabuse.com/test-driven-development-with-pytest/</p></li>
<li><p>https://docs.pytest.org/en/latest/goodpractices.html#conventions-for-python-test-discovery</p></li>
<li><p>https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure</p></li>
<li><p>https://github.com/vanzaj/tdd-pytest/blob/master/docs/tdd-pytest/content/tdd-basics.md</p></li>
<li><p>https://opensource.com/article/18/6/pytest-plugins</p></li>
</ol>
</div>
<div class="section" id="setup">
<h1>setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>install <code class="docutils literal notranslate"><span class="pre">pytest</span></code></p></li>
<li><p>install <code class="docutils literal notranslate"><span class="pre">pytest-sugar</span></code> which will give us nicer output</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="o">-</span><span class="n">q</span> <span class="n">install</span> <span class="n">pytest</span> <span class="n">pytest</span><span class="o">-</span><span class="n">sugar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: You are using pip version 20.2.3; however, version 20.2.4 is available.</span>
<span class=" -Color -Color-Yellow">You should consider upgrading via the &#39;/opt/hostedtoolcache/Python/3.8.6/x64/bin/python -m pip install --upgrade pip&#39; command.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># move to tdd directory</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="k">if</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;tdd&#39;</span><span class="p">:</span>
    <span class="o">%</span><span class="k">mkdir</span> tdd
    <span class="o">%</span><span class="k">cd</span> tdd

<span class="o">%</span><span class="k">pwd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cleanup all files</span>
<span class="o">%</span><span class="k">rm</span> *.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rm: cannot remove &#39;*.py&#39;: No such file or directory
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-pytest-discovers-tests">
<h1>How pytest discovers tests<a class="headerlink" href="#how-pytest-discovers-tests" title="Permalink to this headline">¶</a></h1>
<p>pytests uses the following <a class="reference external" href="https://docs.pytest.org/en/latest/goodpractices.html#conventions-for-python-test-discovery">conventions</a> to automatically discovering tests:</p>
<ol class="simple">
<li><p>files with tests should be called <code class="docutils literal notranslate"><span class="pre">test_*.py</span></code> or <code class="docutils literal notranslate"><span class="pre">*_test.py</span> </code></p></li>
<li><p>test function name should start with <code class="docutils literal notranslate"><span class="pre">test_</span></code></p></li>
</ol>
</div>
<div class="section" id="our-first-test">
<h1>our first test<a class="headerlink" href="#our-first-test" title="Permalink to this headline">¶</a></h1>
<p>to see if our code works, we can use the <code class="docutils literal notranslate"><span class="pre">assert</span></code> python keyword. pytest adds hooks to assertions to make them more useful</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_math.py

<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">test_mul</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">6</span><span class="o">*</span><span class="mi">7</span> <span class="o">==</span> <span class="mi">42</span>

<span class="k">def</span> <span class="nf">test_sin</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_math.py
</pre></div>
</div>
</div>
</div>
<p>now lets run pytest</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_math.py 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 test_math.py <span class=" -Color -Color-Green">✓</span>                                                   <span class=" -Color -Color-Green">33% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▍      </span>
 test_math.py <span class=" -Color -Color-Green">✓✓</span>                                                  <span class=" -Color -Color-Green">67% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████▋   </span>
 test_math.py <span class=" -Color -Color-Green">✓✓✓</span>                                                <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       3 passed</span>
</pre></div>
</div>
</div>
</div>
<p>Great! we just wrote 3 tests that shows that basic math still works</p>
<p>Hurray!</p>
<div class="section" id="your-turn">
<h2>your turn<a class="headerlink" href="#your-turn" title="Permalink to this headline">¶</a></h2>
<p>write a test for the following function.</p>
<p>if there is a bug in the function, fix it</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> make_triangle.py

<span class="c1"># version 1</span>

<span class="k">def</span> <span class="nf">make_triangle</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draws a triangle using &#39;@&#39; letters</span>
<span class="sd">    for instance:</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;\n&#39;.join(make_triangle(3))</span>
<span class="sd">        @</span>
<span class="sd">        @@</span>
<span class="sd">        @@@</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="s1">&#39;@&#39;</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing make_triangle.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="solution">
<h2>solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_make_triangle.py

<span class="kn">from</span> <span class="nn">make_triangle</span> <span class="kn">import</span> <span class="n">make_triangle</span>

<span class="k">def</span> <span class="nf">test_make_triangle</span><span class="p">():</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">make_triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_make_triangle.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_make_triangle.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>

―――――――――――――――――――――――――――――― test_make_triangle ――――――――――――――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    def test_make_triangle():
        expected = <span class=" -Color -Color-Yellow">&quot;@&quot;</span>
        actual = <span class=" -Color -Color-Yellow">&#39;\n&#39;</span>.join(make_triangle(1))
&gt;       assert actual == expected
<span class=" -Color -Color-Bold -Color-Bold-Red">E       AssertionError: assert &#39;&#39; == &#39;@&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         - @</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_make_triangle.py</span>:7: AssertionError



 test_make_triangle.py <span class=" -Color -Color-Red">⨯</span>                                         <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██████████</span>
=========================== short test summary info ============================
FAILED test_make_triangle.py::test_make_triangle - AssertionError: assert &#39;&#39; ...

Results (0.09s):
<span class=" -Color -Color-Red">       1 failed</span>
         - test_make_triangle.py:4 <span class=" -Color -Color-Red">test_make_triangle</span>
</pre></div>
</div>
</div>
</div>
<p>so the expected starts with <code class="docutils literal notranslate"><span class="pre">'&#64;'</span></code> and the actual starts with <code class="docutils literal notranslate"><span class="pre">''</span></code> …</p>
<p>this is a bug! lets fix the code and re-run</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> make_triangle.py

<span class="c1"># version 2 </span>
<span class="k">def</span> <span class="nf">make_triangle</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draws a triangle using &#39;@&#39; letters</span>
<span class="sd">    for instance:</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;\n&#39;.join(make_triangle(3))</span>
<span class="sd">        @</span>
<span class="sd">        @@</span>
<span class="sd">        @@@</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">yield</span> <span class="s1">&#39;@&#39;</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting make_triangle.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_make_triangle.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 test_make_triangle.py <span class=" -Color -Color-Green">✓</span>                                         <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       1 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="pytest-context-sensitive-comparisons">
<h1>Pytest context-sensitive comparisons<a class="headerlink" href="#pytest-context-sensitive-comparisons" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://docs.pytest.org/en/3.0.1/assert.html#making-use-of-context-sensitive-comparisons">Reference</a></p>
<p>pytest has rich support for providing context-sensitive information when it encounters comparisons.</p>
<p>Special comparisons are done for a number of cases:</p>
<ul class="simple">
<li><p>comparing long strings: a context diff is shown</p></li>
<li><p>comparing long sequences: first failing indices</p></li>
<li><p>comparing dicts: different entries</p></li>
</ul>
<p>Here’s how this looks like for set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_compare_fruits.py
<span class="k">def</span> <span class="nf">test_set_comparison</span><span class="p">():</span>
    <span class="n">set1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Apples&#39;</span><span class="p">,</span> <span class="s1">&#39;Bananas&#39;</span><span class="p">,</span> <span class="s1">&#39;Watermelon&#39;</span><span class="p">,</span> <span class="s1">&#39;Pear&#39;</span><span class="p">,</span>  <span class="s1">&#39;Guave&#39;</span><span class="p">,</span> <span class="s1">&#39;Carambola&#39;</span><span class="p">,</span> <span class="s1">&#39;Plum&#39;</span><span class="p">])</span>
    <span class="n">set2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Plum&#39;</span><span class="p">,</span> <span class="s1">&#39;Apples&#39;</span><span class="p">,</span> <span class="s1">&#39;Grapes&#39;</span><span class="p">,</span> <span class="s1">&#39;Watermelon&#39;</span><span class="p">,</span><span class="s1">&#39;Pear&#39;</span><span class="p">,</span> <span class="s1">&#39;Guave&#39;</span><span class="p">,</span> <span class="s1">&#39;Carambola&#39;</span><span class="p">,</span>  <span class="s1">&#39;Melon&#39;</span> <span class="p">])</span>
    <span class="k">assert</span> <span class="n">set1</span> <span class="o">==</span> <span class="n">set2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_compare_fruits.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_compare_fruits.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>

――――――――――――――――――――――――――――― test_set_comparison ――――――――――――――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    def test_set_comparison():
        set1 = set([<span class=" -Color -Color-Yellow">&#39;Apples&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Bananas&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Watermelon&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Pear&#39;</span>,  <span class=" -Color -Color-Yellow">&#39;Guave&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Carambola&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Plum&#39;</span>])
        set2 = set([<span class=" -Color -Color-Yellow">&#39;Plum&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Apples&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Grapes&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Watermelon&#39;</span>,<span class=" -Color -Color-Yellow">&#39;Pear&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Guave&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Carambola&#39;</span>,  <span class=" -Color -Color-Yellow">&#39;Melon&#39;</span> ])
&gt;       assert set1 == set2
<span class=" -Color -Color-Bold -Color-Bold-Red">E       AssertionError: assert {&#39;Apples&#39;, &#39;B..., &#39;Plum&#39;, ...} == {&#39;Apples&#39;, &#39;C..., &#39;Pear&#39;, ...}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Extra items in the left set:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         &#39;Bananas&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Extra items in the right set:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         &#39;Grapes&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         &#39;Melon&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Use -v to get the full diff</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_compare_fruits.py</span>:4: AssertionError



 test_compare_fruits.py <span class=" -Color -Color-Red">⨯</span>                                        <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██████████</span>
=========================== short test summary info ============================
FAILED test_compare_fruits.py::test_set_comparison - AssertionError: assert {...

Results (0.10s):
<span class=" -Color -Color-Red">       1 failed</span>
         - test_compare_fruits.py:1 <span class=" -Color -Color-Red">test_set_comparison</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>your turn<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>test the following function <code class="docutils literal notranslate"><span class="pre">count_words()</span></code> and fix any bugs.</p>
<p>the expected output from the function is given in <code class="docutils literal notranslate"><span class="pre">expected_output</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_output</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;chief&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;didnt&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;efficiency&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;expected&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;expects&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;fear&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;inquisition&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;no&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;our&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;ruthless&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;spanish&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;surprise&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;the&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;weapon&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;weapons&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;well&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> spanish_inquisition.py
<span class="c1"># version 1: buggy</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="n">quote</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Well, I didn&#39;t expected the Spanish Inquisition ...</span>
<span class="s2">No one expects the Spanish Inquisition!</span>
<span class="s2">Our chief weapon is surprise, fear and surprise;</span>
<span class="s2">two chief weapons, fear, surprise, and ruthless efficiency! </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">remove_punctuation</span><span class="p">(</span><span class="n">quote</span><span class="p">):</span>
    <span class="n">quote</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;,.!?;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">quote</span>

<span class="k">def</span> <span class="nf">count_words</span><span class="p">(</span><span class="n">quote</span><span class="p">):</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="n">remove_punctuation</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">quote</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing spanish_inquisition.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>solution<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_spanish_inquisition.py

<span class="kn">from</span> <span class="nn">spanish_inquisition</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">expected_output</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;chief&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;didnt&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;efficiency&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;expected&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;expects&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;fear&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;inquisition&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;no&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;our&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;ruthless&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;spanish&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;surprise&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;the&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;weapon&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;weapons&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;well&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_spanish_inquisition</span><span class="p">():</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">count_words</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected_output</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_spanish_inquisition.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest -vv test_spanish_inquisition.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>

――――――――――――――――――――――――――― test_spanish_inquisition ―――――――――――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    def test_spanish_inquisition():
        actual = count_words(quote)
&gt;       assert actual == expected_output
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert {&#39;\n&#39;: 1,\n &#39;\nWell,&#39;: 1,\n &#39;...\nNo&#39;: 1,\n &#39;I&#39;: 1,\n &#39;Inquisition&#39;: 1,\n &#39;Inquisition!\nOur&#39;: 1,\n &#39;Spanish&#39;: 2,\n &#39;and&#39;: 2,\n &#39;chief&#39;: 2,\n &quot;didn&#39;t&quot;: 1,\n &#39;efficiency!&#39;: 1,\n &#39;expected&#39;: 1,\n &#39;expects&#39;: 1,\n &#39;fear&#39;: 1,\n &#39;fear,&#39;: 1,\n &#39;is&#39;: 1,\n &#39;one&#39;: 1,\n &#39;ruthless&#39;: 1,\n &#39;surprise,&#39;: 2,\n &#39;surprise;\ntwo&#39;: 1,\n &#39;the&#39;: 2,\n &#39;weapon&#39;: 1,\n &#39;weapons,&#39;: 1} == {&#39;and&#39;: 2,\n &#39;chief&#39;: 2,\n &#39;didnt&#39;: 1,\n &#39;efficiency&#39;: 1,\n &#39;expected&#39;: 1,\n &#39;expects&#39;: 1,\n &#39;fear&#39;: 2,\n &#39;i&#39;: 1,\n &#39;inquisition&#39;: 2,\n &#39;is&#39;: 1,\n &#39;no&#39;: 1,\n &#39;one&#39;: 1,\n &#39;our&#39;: 1,\n &#39;ruthless&#39;: 1,\n &#39;spanish&#39;: 2,\n &#39;surprise&#39;: 3,\n &#39;the&#39;: 2,\n &#39;two&#39;: 1,\n &#39;weapon&#39;: 1,\n &#39;weapons&#39;: 1,\n &#39;well&#39;: 1}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Common items:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         {&#39;and&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;chief&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;expected&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;expects&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;is&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;one&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;ruthless&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;the&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;weapon&#39;: 1}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Differing items:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         {&#39;fear&#39;: 1} != {&#39;fear&#39;: 2}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Left contains 13 more items:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         {&#39;\n&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;\nWell,&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;...\nNo&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;I&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;Inquisition&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;Inquisition!\nOur&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;Spanish&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &quot;didn&#39;t&quot;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;efficiency!&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;fear,&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;surprise,&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;surprise;\ntwo&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;weapons,&#39;: 1}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Right contains 11 more items:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         {&#39;didnt&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;efficiency&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;i&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;inquisition&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;no&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;our&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;spanish&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;surprise&#39;: 3,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;two&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;weapons&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E          &#39;well&#39;: 1}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Full diff:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E           {</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;\n&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;\nWell,&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;...\nNo&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;I&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;Inquisition&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;Inquisition!\nOur&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;Spanish&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;and&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;chief&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;didnt&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?  ^     ^</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &quot;didn&#39;t&quot;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?  ^    + ^</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;efficiency&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;efficiency!&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?             +</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;expected&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;expects&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;fear&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?          ^</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;fear&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?          ^</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;fear,&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;i&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;inquisition&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;is&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;no&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;one&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;our&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;ruthless&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;spanish&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;surprise&#39;: 3,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?              ^</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;surprise,&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?           +   ^</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;surprise;\ntwo&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;the&#39;: 2,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;two&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E            &#39;weapon&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;weapons&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         +  &#39;weapons,&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         ?          +</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         -  &#39;well&#39;: 1,</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E           }</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_spanish_inquisition.py</span>:29: AssertionError
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_spanish_inquisition.py</span>::test_spanish_inquisition <span class=" -Color -Color-Red">⨯</span>         <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██████████</span>
=========================== short test summary info ============================
FAILED test_spanish_inquisition.py::test_spanish_inquisition - assert {&#39;\n&#39;: ...

Results (0.10s):
<span class=" -Color -Color-Red">       1 failed</span>
         - test_spanish_inquisition.py:27 <span class=" -Color -Color-Red">test_spanish_inquisition</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> spanish_inquisition.py
<span class="c1"># version 2: fixed</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="n">quote</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Well, I didn&#39;t expected the Spanish Inquisition ...</span>
<span class="s2">No one expects the Spanish Inquisition!</span>
<span class="s2">Our chief weapon is surprise, fear and surprise;</span>
<span class="s2">two chief weapons, fear, surprise, and ruthless efficiency! </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">remove_punctuation</span><span class="p">(</span><span class="n">quote</span><span class="p">):</span>
    <span class="c1"># quote.translate(str.maketrans(&#39;&#39;, &#39;&#39;, &quot;&#39;,.!?;&quot;)).lower() # BUG: missing return</span>
    <span class="k">return</span> <span class="n">quote</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;,.!?;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">count_words</span><span class="p">(</span><span class="n">quote</span><span class="p">):</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="n">remove_punctuation</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span>
    <span class="c1"># return dict(collections.Counter(quote.split(&#39; &#39;))) # BUG</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">quote</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting spanish_inquisition.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest -vv test_spanish_inquisition.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 <span class=" -Color -Color-Cyan">test_spanish_inquisition.py</span>::test_spanish_inquisition <span class=" -Color -Color-Green">✓</span>         <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       1 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="using-fixtures-to-simplify-tests">
<h1>Using fixtures to simplify tests<a class="headerlink" href="#using-fixtures-to-simplify-tests" title="Permalink to this headline">¶</a></h1>
<div class="section" id="motivating-example">
<h2>Motivating example<a class="headerlink" href="#motivating-example" title="Permalink to this headline">¶</a></h2>
<p>Lets look at an example of class <code class="docutils literal notranslate"><span class="pre">Person</span></code>, where each person has a name and remembers their friends.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> person.py

<span class="c1">#version 1</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">favorite_color</span><span class="p">,</span> <span class="n">year_born</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">favorite_color</span> <span class="o">=</span> <span class="n">favorite_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year_born</span> <span class="o">=</span> <span class="n">year_born</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">friends</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_friend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_person</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_person</span><span class="p">,</span> <span class="n">Person</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">other_person</span><span class="p">,</span> <span class="s1">&#39;is not a&#39;</span><span class="p">,</span> <span class="n">Person</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">friends</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_person</span><span class="p">)</span>
        <span class="n">other_person</span><span class="o">.</span><span class="n">friends</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Person(name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s1">, &#39;</span>  \
               <span class="sa">f</span><span class="s1">&#39;favorite_color=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">favorite_color</span><span class="si">!r}</span><span class="s1">, &#39;</span> \
               <span class="sa">f</span><span class="s1">&#39;year_born=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year_born</span><span class="si">!r}</span><span class="s1">, &#39;</span> \
               <span class="sa">f</span><span class="s1">&#39;friends=</span><span class="si">{</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">friends</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing person.py
</pre></div>
</div>
</div>
</div>
<p>Lets write a test for <code class="docutils literal notranslate"><span class="pre">add_friend()</span></code> function.</p>
<p>notice how the setup for the test is taking so much of the function, while also requiring <em>inventing</em> a lot of repetitious data</p>
<p>is there a way to reduce this boiler plate code</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_person.py

<span class="kn">from</span> <span class="nn">person</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="k">def</span> <span class="nf">test_name</span><span class="p">():</span>
    <span class="c1"># setup</span>
    <span class="n">terry</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span>
        <span class="s1">&#39;Terry Gilliam&#39;</span><span class="p">,</span>
        <span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="mi">1940</span>
        <span class="p">)</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">terry</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Terry Gilliam&#39;</span> 


<span class="k">def</span> <span class="nf">test_add_friend</span><span class="p">():</span>
    <span class="c1"># setup for the test </span>
    <span class="n">terry</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span>
        <span class="s1">&#39;Terry Gilliam&#39;</span><span class="p">,</span>
        <span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="mi">1940</span>
        <span class="p">)</span>
    <span class="n">eric</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span>
        <span class="s1">&#39;Eric Idle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="mi">1943</span>
        <span class="p">)</span>
    
    <span class="c1"># actual test</span>
    <span class="n">terry</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">eric</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">eric</span> <span class="ow">in</span> <span class="n">terry</span><span class="o">.</span><span class="n">friends</span>
    <span class="k">assert</span> <span class="n">terry</span> <span class="ow">in</span> <span class="n">eric</span><span class="o">.</span><span class="n">friends</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_person.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest -q test_person.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4



 test_person.py <span class=" -Color -Color-Green">✓</span>                                                 <span class=" -Color -Color-Green">50% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████     </span>
 test_person.py <span class=" -Color -Color-Green">✓✓</span>                                               <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       2 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fixtures-to-the-rescue">
<h2>Fixtures to the rescue<a class="headerlink" href="#fixtures-to-the-rescue" title="Permalink to this headline">¶</a></h2>
<p>what is we had a magic factory that can conjure up a name, favorite color and birth year?</p>
<p>then we could write our <code class="docutils literal notranslate"><span class="pre">test_name()</span></code> more simply like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_name</span><span class="p">(</span><span class="n">person_name</span><span class="p">,</span> <span class="n">favorite_color</span><span class="p">,</span> <span class="n">birth_year</span><span class="p">):</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">person_name</span><span class="p">,</span> <span class="n">favorite_color</span><span class="p">,</span> <span class="n">birth_year</span><span class="p">)</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">person_name</span> 
</pre></div>
</div>
<p>furthermore, if we had a magic factory that can create <code class="docutils literal notranslate"><span class="pre">terry</span></code> and <code class="docutils literal notranslate"><span class="pre">eric</span></code> we could write our <code class="docutils literal notranslate"><span class="pre">test_add_friend()</span></code> function like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_add_friend</span><span class="p">(</span><span class="n">eric</span><span class="p">,</span> <span class="n">terry</span><span class="p">):</span>
    <span class="n">eric</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">terry</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">eric</span> <span class="ow">in</span> <span class="n">terry</span><span class="o">.</span><span class="n">friends</span>
    <span class="k">assert</span> <span class="n">terry</span> <span class="ow">in</span> <span class="n">eric</span><span class="o">.</span><span class="n">friends</span>
</pre></div>
</div>
<p>fixtures in <code class="docutils literal notranslate"><span class="pre">pytest</span></code> allow us to create such magic factories using the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code> notation.</p>
<p>here’s an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_person_fixtures1.py

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">person</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">person_name</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Terry Gilliam&#39;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">birth_year</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1940</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">favorite_color</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;red&#39;</span>

<span class="k">def</span> <span class="nf">test_person_name</span><span class="p">(</span><span class="n">person_name</span><span class="p">,</span> <span class="n">favorite_color</span><span class="p">,</span> <span class="n">birth_year</span><span class="p">):</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">person_name</span><span class="p">,</span> <span class="n">favorite_color</span><span class="p">,</span> <span class="n">birth_year</span><span class="p">)</span>
 
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">person_name</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_person_fixtures1.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_person_fixtures1.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 test_person_fixtures1.py <span class=" -Color -Color-Green">✓</span>                                      <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       1 passed</span>
</pre></div>
</div>
</div>
</div>
<p>what’s happening here?</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> sees that the test function <code class="docutils literal notranslate"><span class="pre">test_person_name(person_name,</span> <span class="pre">favorite_color,</span> <span class="pre">birth_year)</span></code> requires three parameters, and searches for fixtures annotated with <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code> with the same name.</p>
<p>when it finds them, it calls these fixtures on our behalf, and passes the return value as the parameter. in effect, it calls</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_person_name</span><span class="p">(</span><span class="n">person_name</span><span class="o">=</span><span class="n">person_name</span><span class="p">(),</span> <span class="n">favorite_color</span><span class="o">=</span><span class="n">favorite_color</span><span class="p">(),</span> <span class="n">birth_year</span><span class="o">=</span><span class="n">birth_year</span><span class="p">()</span>
</pre></div>
</div>
<p>note how much code this saves</p>
</div>
<div class="section" id="id3">
<h2>your turn<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>rewrite the <code class="docutils literal notranslate"><span class="pre">test_add_friend</span></code> function to accept two parameters <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">test_add_friend(eric,</span> <span class="pre">terry)</span></code></p></li>
<li><p>write fixtures for eric and terry</p></li>
<li><p>run pytest</p></li>
</ol>
</div>
<div class="section" id="id4">
<h2>solution<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_person_fixtures2.py

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">person</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">eric</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Eric Idle&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="mi">1943</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">terry</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Terry Gilliam&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_add_friend</span><span class="p">(</span><span class="n">eric</span><span class="p">,</span> <span class="n">terry</span><span class="p">):</span>
    <span class="n">eric</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">terry</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">eric</span> <span class="ow">in</span> <span class="n">terry</span><span class="o">.</span><span class="n">friends</span>
    <span class="k">assert</span> <span class="n">terry</span> <span class="ow">in</span> <span class="n">eric</span><span class="o">.</span><span class="n">friends</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_person_fixtures2.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest -q test_person_fixtures2.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4



 test_person_fixtures2.py <span class=" -Color -Color-Green">✓</span>                                      <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       1 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="parameterizing-fixtures">
<h1>parameterizing fixtures<a class="headerlink" href="#parameterizing-fixtures" title="Permalink to this headline">¶</a></h1>
<p>Fixture functions can be parametrized in which case they will be called multiple times, each time executing the set of dependent tests, i. e. the tests that depend on this fixture.</p>
<p>Test functions usually do not need to be aware of their re-running. Fixture parametrization helps to write exhaustive functional tests for components which themselves can be configured in multiple ways.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_primes.py

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">factor</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">101</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">prime_number</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

<span class="k">def</span> <span class="nf">test_prime</span><span class="p">(</span><span class="n">prime_number</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">prime_number</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_primes.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest --verbose test_primes.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[2] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">11% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▎        </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[3] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">22% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▎       </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[5] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">33% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▍      </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[7] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">44% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████▌     </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[11] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">56% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████▋    </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[13] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">67% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████▋   </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[17] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">78% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███████▊  </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[19] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">89% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████████▉ </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[101] <span class=" -Color -Color-Green">✓</span>                               <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.03s):
<span class=" -Color -Color-Green">       9 passed</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>your turn<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>test <code class="docutils literal notranslate"><span class="pre">is_prime()</span></code> for non prime numbers</p>
<blockquote>
<div><p>bonus: can you find and fix the bug in <code class="docutils literal notranslate"><span class="pre">is_prime()</span></code> using a test?</p>
</div></blockquote>
</div>
<div class="section" id="id6">
<h2>solution<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_non_primes.py

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">FIX_BUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">FIX_BUG</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">is_prime_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="c1"># notice the +1 - it is important when x=4</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">factor</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">is_prime</span> <span class="o">=</span> <span class="n">is_prime_fixed</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">test_primes</span> <span class="kn">import</span> <span class="n">is_prime</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">non_prime_number</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

<span class="k">def</span> <span class="nf">test_non_primes</span><span class="p">(</span><span class="n">non_prime_number</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">non_prime_number</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_non_primes.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest --verbose test_non_primes.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[4] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">8% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">▉         </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[6] <span class=" -Color -Color-Green">✓</span>                         <span class=" -Color -Color-Green">17% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▋        </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[8] <span class=" -Color -Color-Green">✓</span>                         <span class=" -Color -Color-Green">25% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▌       </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[9] <span class=" -Color -Color-Green">✓</span>                         <span class=" -Color -Color-Green">33% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▍      </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[10] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">42% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████▎     </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[12] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">50% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████     </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[14] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">58% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████▉    </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[15] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">67% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████▋   </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[16] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">75% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███████▌  </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[28] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">83% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████████▍ </span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[60] <span class=" -Color -Color-Green">✓</span>                        <span class=" -Color -Color-Green">92% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████████▎</span>


 <span class=" -Color -Color-Cyan">test_non_primes.py</span>::test_non_primes[100] <span class=" -Color -Color-Green">✓</span>                      <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.03s):
<span class=" -Color -Color-Green">      12 passed</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">all</span><span class="p">([</span><span class="n">factor</span> <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">))])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest --verbose test_primes.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[2] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">11% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▎        </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[3] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">22% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▎       </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[5] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">33% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▍      </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[7] <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Green">44% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████▌     </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[11] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">56% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████▋    </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[13] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">67% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████▋   </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[17] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">78% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███████▊  </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[19] <span class=" -Color -Color-Green">✓</span>                                 <span class=" -Color -Color-Green">89% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████████▉ </span>


 <span class=" -Color -Color-Cyan">test_primes.py</span>::test_prime[101] <span class=" -Color -Color-Green">✓</span>                               <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.03s):
<span class=" -Color -Color-Green">       9 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="printing-and-logging-within-tests">
<h1>printing and logging within tests<a class="headerlink" href="#printing-and-logging-within-tests" title="Permalink to this headline">¶</a></h1>
<div class="section" id="printing">
<h2>printing<a class="headerlink" href="#printing" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://docs.pytest.org/en/latest/capture.html">Reference</a></p>
<p>You can use prints within tests to provide additional debug info.</p>
<p>pytest redirects the output and captured the output of each test. it then:</p>
<ul class="simple">
<li><p><strong>suppresses</strong> the output of all <strong>successful</strong> tests (for brevity)</p></li>
<li><p><strong>shows</strong> the output off all <strong>failed</strong> tests (for debugging)</p></li>
<li><p>both <code class="docutils literal notranslate"><span class="pre">stdout</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> are captured</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_prints.py
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">test_print_success</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        this statement will NOT be printed</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="mi">6</span><span class="o">*</span><span class="mi">7</span> <span class="o">==</span> <span class="mi">42</span>

<span class="k">def</span> <span class="nf">test_print_fail</span><span class="p">():</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        this statement WILL be printed</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">test_stderr_capture_success</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        this STDERR statement will NOT be printed</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span> 
        <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="p">)</span>
     
    <span class="k">assert</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">test_stderr_capture_fail</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        this STDERR statement WILL be printed</span>
<span class="sd">        @@@@@@@@@@@@@@@</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span> 
        <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="p">)</span>
     
    <span class="k">assert</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_prints.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest -q test_prints.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4



 test_prints.py <span class=" -Color -Color-Green">✓</span>                                                 <span class=" -Color -Color-Green">25% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▌       </span>

――――――――――――――――――――――――――――――― test_print_fail ――――――――――――――――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    def test_print_fail():
    
        print(
            <span class=" -Color -Color-Yellow">&quot;&quot;&quot;</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        this statement WILL be printed</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        &quot;&quot;&quot;</span>
        )
&gt;       assert True == False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert True == False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_prints.py</span>:23: AssertionError
----------------------------- Captured stdout call -----------------------------

        @@@@@@@@@@@@@@@
        this statement WILL be printed
        @@@@@@@@@@@@@@@
        



 test_prints.py <span class=" -Color -Color-Red">⨯</span>                                                 <span class=" -Color -Color-Red">50% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██</span><span class=" -Color -Color-Red -Color-Red-BGBlack">███     </span>
 test_prints.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓</span>                                                <span class=" -Color -Color-Red">75% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██</span><span class=" -Color -Color-Red -Color-Red-BGBlack">███</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▌  </span>

――――――――――――――――――――――――――― test_stderr_capture_fail ―――――――――――――――――――――――――――

    def test_stderr_capture_fail():
        print(
            <span class=" -Color -Color-Yellow">&quot;&quot;&quot;</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        this STDERR statement WILL be printed</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        &quot;&quot;&quot;</span>,
            file=sys.stderr
        )
    
&gt;       assert False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_prints.py</span>:49: AssertionError
----------------------------- Captured stderr call -----------------------------

        @@@@@@@@@@@@@@@
        this STDERR statement WILL be printed
        @@@@@@@@@@@@@@@
        



 test_prints.py <span class=" -Color -Color-Red">⨯</span>                                                <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██</span><span class=" -Color -Color-Red -Color-Red-BGBlack">███</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██</span><span class=" -Color -Color-Red -Color-Red-BGBlack">███</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=========================== short test summary info ============================
FAILED test_prints.py::test_print_fail - assert True == False
FAILED test_prints.py::test_stderr_capture_fail - assert False

Results (0.10s):
<span class=" -Color -Color-Green">       2 passed</span>
<span class=" -Color -Color-Red">       2 failed</span>
         - test_prints.py:14 <span class=" -Color -Color-Red">test_print_fail</span>
         - test_prints.py:39 <span class=" -Color -Color-Red">test_stderr_capture_fail</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="logging">
<h2>logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://docs.pytest.org/en/latest/logging.html">Reference</a></p>
<p>pytest captures log messages of level WARNING or above automatically and displays them in their own section for each failed test in the same manner as captured stdout and stderr.</p>
<ul class="simple">
<li><p>WARNING and above will displayed for failed tests</p></li>
<li><p>INFO and below will not be displayed</p></li>
</ul>
<p>example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_logging.py

<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_logging_warning_success</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> @@@ this will NOT be printed </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">test_logging_warning_fail</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> @@@ this WILL be printed @@@ </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">test_logging_info_fail</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> @@@ this will NOT be printed @@@ </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_logging.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_logging.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 test_logging.py <span class=" -Color -Color-Green">✓</span>                                                <span class=" -Color -Color-Green">33% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▍      </span>

―――――――――――――――――――――――――― test_logging_warning_fail ―――――――――――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    def test_logging_warning_fail():
        logger.warning(<span class=" -Color -Color-Yellow">&#39;\n\n @@@ this WILL be printed @@@ \n\n&#39;</span>)
&gt;       assert False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_logging.py</span>:12: AssertionError
------------------------------ Captured log call -------------------------------
<span class=" -Color -Color-Yellow">WARNING </span> test_logging:test_logging.py:11 

 @@@ this WILL be printed @@@



 test_logging.py <span class=" -Color -Color-Red">⨯</span>                                                <span class=" -Color -Color-Red">67% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">███▋   </span>

―――――――――――――――――――――――――――― test_logging_info_fail ――――――――――――――――――――――――――――

    def test_logging_info_fail():
        logger.info(<span class=" -Color -Color-Yellow">&#39;\n\n @@@ this will NOT be printed @@@ \n\n&#39;</span>)
&gt;       assert False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_logging.py</span>:16: AssertionError



 test_logging.py <span class=" -Color -Color-Red">⨯</span>                                               <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">███████</span>
=========================== short test summary info ============================
FAILED test_logging.py::test_logging_warning_fail - assert False
FAILED test_logging.py::test_logging_info_fail - assert False

Results (0.10s):
<span class=" -Color -Color-Green">       1 passed</span>
<span class=" -Color -Color-Red">       2 failed</span>
         - test_logging.py:10 <span class=" -Color -Color-Red">test_logging_warning_fail</span>
         - test_logging.py:14 <span class=" -Color -Color-Red">test_logging_info_fail</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>your turn<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>We give below an implementation of the <em>FizzBuzz</em> puzzle:</p>
<blockquote>
<div><p>Write a function that returns the numbers from 1 to 100. But for multiples of three returns “Fizz” instead of the number and for the multiples of five returns “Buzz”. For numbers which are multiples of both three and five return “FizzBuzz”.</p>
</div></blockquote>
<p>thus this SHOULD be true</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fizzbuzz</span><span class="p">()</span> <span class="c1"># should return the following (abridged) output</span>
<span class="go">[1, 2, &#39;Fizz&#39;, 4, &#39;Buzz&#39;, 6, 7, 8, &#39;Fizz&#39;, &#39;Buzz&#39;, 11, &#39;Fizz&#39;, 13, 14, &#39;FizzBuzz&#39;, ... ]</span>
</pre></div>
</div>
<p>BUT the implementation is buggy. can you write tests for it and fix it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> fizzbuzz.py

<span class="k">def</span> <span class="nf">is_multiple</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">%</span> <span class="n">divisor</span> <span class="o">==</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">fizzbuzz</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    expected output: list with elements numbers </span>
<span class="sd">        [1, 2, &#39;Fizz&#39;, 4, &#39;Buzz&#39;, 6, 7, 8, &#39;Fizz&#39;, &#39;Buzz&#39;, 11, &#39;Fizz&#39;, 13, 14, &#39;FizzBuzz&#39;, ... ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_multiple</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Fizz&quot;</span>
        <span class="k">elif</span> <span class="n">is_multiple</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Buzz&quot;</span>
        <span class="k">elif</span> <span class="n">is_multiple</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_multiple</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;FizzBuzz&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>
    
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing fizzbuzz.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id8">
<h2>solution<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_fizzbuzz.py

<span class="n">FIX_BUG</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">FIX_BUG</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">fizzbuzz</span> <span class="kn">import</span> <span class="n">fizzbuzz</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">fizzbuzz_fixed</span><span class="p">():</span>
        <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;FizzBuzz&quot;</span>
            <span class="k">elif</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Fizz&quot;</span>
            <span class="k">elif</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Buzz&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">translate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="n">fizzbuzz</span> <span class="o">=</span> <span class="n">fizzbuzz_fixed</span>


<span class="kn">import</span> <span class="nn">pytest</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">fizzbuzz_result</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">fizzbuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">fizzbuzz_dict</span><span class="p">(</span><span class="n">fizzbuzz_result</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">fizzbuzz_result</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">test_fizzbuzz_len</span><span class="p">(</span><span class="n">fizzbuzz_result</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fizzbuzz_result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">100</span>

<span class="k">def</span> <span class="nf">test_fizzbuzz_len</span><span class="p">(</span><span class="n">fizzbuzz_result</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">fizzbuzz_result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>

<span class="k">def</span> <span class="nf">test_fizzbuzz_first_element</span><span class="p">(</span><span class="n">fizzbuzz_dict</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fizzbuzz_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">test_fizzbuzz_3</span><span class="p">(</span><span class="n">fizzbuzz_dict</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fizzbuzz_dict</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Fizz&#39;</span>

<span class="k">def</span> <span class="nf">test_fizzbuzz_5</span><span class="p">(</span><span class="n">fizzbuzz_dict</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fizzbuzz_dict</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Buzz&#39;</span>

<span class="k">def</span> <span class="nf">test_fizzbuzz_15</span><span class="p">(</span><span class="n">fizzbuzz_dict</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fizzbuzz_dict</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FizzBuzz&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_fizzbuzz.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_fizzbuzz.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 test_fizzbuzz.py <span class=" -Color -Color-Green">✓</span>                                               <span class=" -Color -Color-Green">20% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██        </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓</span>                                              <span class=" -Color -Color-Green">40% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████      </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓✓</span>                                             <span class=" -Color -Color-Green">60% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████    </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓✓✓</span>                                            <span class=" -Color -Color-Green">80% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████████  </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓✓✓✓</span>                                          <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.03s):
<span class=" -Color -Color-Green">       5 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="float-when-things-are-almost-equal">
<h1>float: when things are (almost) equal<a class="headerlink" href="#float-when-things-are-almost-equal" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://docs.pytest.org/en/latest/reference.html#pytest-approx">Reference</a></p>
<p>consider the following code, what do you expect the result to be?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x == y&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">==</span><span class="n">y</span><span class="p">)</span> <span class="c1"># what will it print?</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x == y:&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># what will it print?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x == y: False
</pre></div>
</div>
</div>
</div>
<p>if you had anticipated <code class="docutils literal notranslate"><span class="pre">True</span></code> it means you haven’t tried testing code with <code class="docutils literal notranslate"><span class="pre">float</span></code> data yet</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.30000000000000004 != 0.3
</pre></div>
</div>
</div>
</div>
<p>the issue is that float is <em>approxiamtely</em> accurate (enough for most calculations) but may have small rounding errors.</p>
<p>here’e a common but ugly way to test for float equivalence</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">abs</span><span class="p">((</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>here’s a more pythonic and pytest-tic way, using <code class="docutils literal notranslate"><span class="pre">pytest.approx</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>
<span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h2>your turn<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>test that</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">math.sin(0)</span> <span class="pre">==</span> <span class="pre">0</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">math.sin(math.pi</span> <span class="pre">/</span> <span class="pre">2)</span> <span class="pre">==</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">math.sin(math.pi)</span> <span class="pre">==</span> <span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">math.sin(math.pi</span> <span class="pre">*</span> <span class="pre">3/2)</span> <span class="pre">==</span> <span class="pre">-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">math.sin(math.pi</span> <span class="pre">*</span> <span class="pre">2)</span> <span class="pre">==</span> <span class="pre">0</span></code></p></li>
</ul>
</div>
<div class="section" id="id10">
<h2>solution<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_sin.py

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">test_sin</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_sin.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_sin.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>


 test_sin.py <span class=" -Color -Color-Green">✓</span>                                                   <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (0.02s):
<span class=" -Color -Color-Green">       1 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-timeouts-to-tests">
<h1>adding timeouts to tests<a class="headerlink" href="#adding-timeouts-to-tests" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://pypi.org/project/pytest-timeout/">Reference</a></p>
<p>Sometimes code gets stuck in an infinite loop, or waiting for a response from a server.
Sometimes, tests that run too long is in <em>itself</em> an indication of failure.</p>
<p>how can we add timeouts to tests to avoid getting stuck?
the package <code class="docutils literal notranslate"><span class="pre">pytest-timeout</span></code> solves for that by providing a plugin to pytest.</p>
<ol class="simple">
<li><p>install the package using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pytest-timeout</span></code></p></li>
<li><p>you can set timeouts individually on tests by marking them with the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.timeout(timeout=60)</span></code> decorator</p></li>
<li><p>you can set the timeout for all tests globally by using the timeout commandline parameter for pytest, like so:<code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--timeout=300</span></code></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">pytest</span><span class="o">-</span><span class="n">timeout</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: You are using pip version 20.2.3; however, version 20.2.4 is available.</span>
<span class=" -Color -Color-Yellow">You should consider upgrading via the &#39;/opt/hostedtoolcache/Python/3.8.6/x64/bin/python -m pip install --upgrade pip&#39; command.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_timeouts.py

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_infinite_sleep</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sleeping ...&#39;</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">test_empty</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_timeouts.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest --verbose test_timeouts.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4, timeout-1.4.2
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――――――――――――――― test_infinite_sleep ――――――――――――――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    <span class=" -Color -Color-White">@pytest</span>.mark.timeout(5)
    def test_infinite_sleep():
        import time
        while True:
&gt;           time.sleep(1)
<span class=" -Color -Color-Bold -Color-Bold-Red">E           Failed: Timeout &gt;5.0s</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_timeouts.py</span>:8: Failed
----------------------------- Captured stdout call -----------------------------
sleeping ...
sleeping ...
sleeping ...
sleeping ...



 <span class=" -Color -Color-Cyan">test_timeouts.py</span>::test_infinite_sleep <span class=" -Color -Color-Red">⨯</span>                          <span class=" -Color -Color-Red">50% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█████     </span>


 <span class=" -Color -Color-Cyan">test_timeouts.py</span>::test_empty <span class=" -Color -Color-Green">✓</span>                                  <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█████</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████</span>
=========================== short test summary info ============================
FAILED test_timeouts.py::test_infinite_sleep - Failed: Timeout &gt;5.0s

Results (5.10s):
<span class=" -Color -Color-Green">       1 passed</span>
<span class=" -Color -Color-Red">       1 failed</span>
         - test_timeouts.py:4 <span class=" -Color -Color-Red">test_infinite_sleep</span>
</pre></div>
</div>
</div>
</div>
<p>notice how the <code class="docutils literal notranslate"><span class="pre">test_empty</span></code> test still runs and passes, even though the previous test was aborted</p>
<div class="section" id="id11">
<h2>your turn<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> module to <code class="docutils literal notranslate"><span class="pre">.get()</span></code> the url http://httpstat.us/101 and call <code class="docutils literal notranslate"><span class="pre">.raise_for_status()</span></code></p></li>
<li><p>since this will hang forever, use a timeout on the test so that it fails after 5 seconds</p></li>
<li><p>since the test is guranteed to fail, mark it with the <code class="docutils literal notranslate"><span class="pre">xfail</span></code> (<em>expected fail</em>) annotation <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.xfail(reason='timeout')</span></code></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_http101_timeout.py

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_http101_timeout</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpstat.us/101&#39;</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_http101_timeout.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_http101_timeout.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4, timeout-1.4.2
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_http101_timeout.py <span class=" -Color -Color-Green">x</span>                                       <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (2.32s):
<span class=" -Color -Color-Green">       1 xfailed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="testing-for-exceptions">
<h1>testing for exceptions<a class="headerlink" href="#testing-for-exceptions" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://docs.pytest.org/en/3.0.1/assert.html#assertions-about-expected-exceptions">Reference</a></p>
<p>consider the following code fragment from <code class="docutils literal notranslate"><span class="pre">person.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">add_friend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_person</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_person</span><span class="p">,</span> <span class="n">Person</span><span class="p">)</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">other_person</span><span class="p">,</span> <span class="s1">&#39;is not a&#39;</span><span class="p">,</span> <span class="n">Person</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">friends</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_person</span><span class="p">)</span>
        <span class="n">other_person</span><span class="o">.</span><span class="n">friends</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>the <code class="docutils literal notranslate"><span class="pre">add_friend()</span></code> method will raise an exception if it is used with a parameter which is not a <code class="docutils literal notranslate"><span class="pre">Person</span></code></p>
<p>how can we test this?</p>
<p>if we wrap the code that is supposed to throw the exc</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_add_person_exception.py

<span class="kn">from</span> <span class="nn">person</span> <span class="kn">import</span> <span class="n">Person</span>
<span class="kn">from</span> <span class="nn">test_person_fixtures2</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">test_add_person_exception</span><span class="p">(</span><span class="n">terry</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">terry</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="s2">&quot;a shrubbey!&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_add_person_exception_detailed</span><span class="p">(</span><span class="n">terry</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">excinfo</span><span class="p">:</span>
        <span class="n">terry</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="s2">&quot;a shrubbey!&quot;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="s1">&#39;Person&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">excinfo</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;expected to fail&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_add_person_no_exception</span><span class="p">(</span><span class="n">terry</span><span class="p">,</span> <span class="n">eric</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="c1"># is expecting an exception that won&#39;t happen</span>
        <span class="n">terry</span><span class="o">.</span><span class="n">add_friend</span><span class="p">(</span><span class="n">eric</span><span class="p">)</span> <span class="c1"># this does not throw an exception</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_add_person_exception.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest test_add_person_exception.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4, timeout-1.4.2
<span class=" -Color -Color-Bold">collecting ... </span>


 test_add_person_exception.py <span class=" -Color -Color-Green">✓</span>                                   <span class=" -Color -Color-Green">25% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▌       </span>
 test_add_person_exception.py <span class=" -Color -Color-Green">✓✓</span>                                  <span class=" -Color -Color-Green">50% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████     </span>
 test_add_person_exception.py <span class=" -Color -Color-Green">✓✓x</span>                                 <span class=" -Color -Color-Green">75% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███████▌  </span>
 test_add_person_exception.py <span class=" -Color -Color-Green">✓✓x✓</span>                               <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results (0.04s):
<span class=" -Color -Color-Green">       3 passed</span>
<span class=" -Color -Color-Green">       1 xfailed</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id12">
<h2>your turn<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> module and the <code class="docutils literal notranslate"><span class="pre">.raise_for_status()</span></code> method</p>
<ol class="simple">
<li><p>test that <code class="docutils literal notranslate"><span class="pre">.raise_for_status</span></code> will raise an exception when accessing the following URLs:</p>
<ul class="simple">
<li><p>http://httpstat.us/401</p></li>
<li><p>http://httpstat.us/404</p></li>
<li><p>http://httpstat.us/500</p></li>
<li><p>http://httpstat.us/501</p></li>
</ul>
</li>
<li><p>test that <code class="docutils literal notranslate"><span class="pre">.raise_for_status</span></code> will NOT raise an exception when accessing the following URLs:</p>
<ul class="simple">
<li><p>http://httpstat.us/200</p></li>
<li><p>http://httpstat.us/201</p></li>
<li><p>http://httpstat.us/202</p></li>
<li><p>http://httpstat.us/203</p></li>
<li><p>http://httpstat.us/204</p></li>
<li><p>http://httpstat.us/303</p></li>
<li><p>http://httpstat.us/304</p></li>
</ul>
</li>
</ol>
<div class="section" id="hints">
<h3>hints:<a class="headerlink" href="#hints" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">requests</span></code> module raises exceptions of type <code class="docutils literal notranslate"><span class="pre">requests.HTTPError</span></code></p></li>
<li><p>use parameterized fixtures to avoid writing a lot of tests or boilerplate code</p></li>
<li><p>use timeouts to avoid tests that wait forever</p></li>
</ol>
</div>
</div>
<div class="section" id="id13">
<h2>solution<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_requests.py

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">304</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">good_url</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;http://httpstat.us/</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="mi">401</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">501</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">bad_url</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;http://httpstat.us/</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_good_urls</span><span class="p">(</span><span class="n">good_url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">good_url</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_bad_urls</span><span class="p">(</span><span class="n">bad_url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bad_url</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_requests.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span><span class="o">-</span><span class="n">sugar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest-sugar in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (0.9.4)
Requirement already satisfied: termcolor&gt;=1.1.0 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest-sugar) (1.1.0)
Requirement already satisfied: packaging&gt;=14.1 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest-sugar) (20.4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest&gt;=2.9 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest-sugar) (6.1.1)
Requirement already satisfied: six in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from packaging&gt;=14.1-&gt;pytest-sugar) (1.15.0)
Requirement already satisfied: pyparsing&gt;=2.0.2 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from packaging&gt;=14.1-&gt;pytest-sugar) (2.4.7)
Requirement already satisfied: py&gt;=1.8.2 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest&gt;=2.9-&gt;pytest-sugar) (1.9.0)
Requirement already satisfied: toml in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest&gt;=2.9-&gt;pytest-sugar) (0.10.1)
Requirement already satisfied: pluggy&lt;1.0,&gt;=0.12 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest&gt;=2.9-&gt;pytest-sugar) (0.13.1)
Requirement already satisfied: iniconfig in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest&gt;=2.9-&gt;pytest-sugar) (1.1.1)
Requirement already satisfied: attrs&gt;=17.4.0 in /opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages (from pytest&gt;=2.9-&gt;pytest-sugar) (20.2.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: You are using pip version 20.2.3; however, version 20.2.4 is available.</span>
<span class=" -Color -Color-Yellow">You should consider upgrading via the &#39;/opt/hostedtoolcache/Python/3.8.6/x64/bin/python -m pip install --upgrade pip&#39; command.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest --verbose test_requests.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
cachedir: .pytest_cache
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4, timeout-1.4.2
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[200] <span class=" -Color -Color-Green">✓</span>                           <span class=" -Color -Color-Green">9% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">▉         </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[201] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">18% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▊        </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[202] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">27% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▊       </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[203] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">36% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▋      </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[204] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">45% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████▋     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[303] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">55% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████▌    </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_good_urls[304] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">64% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████▍   </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_bad_urls[401] <span class=" -Color -Color-Green">✓</span>                           <span class=" -Color -Color-Green">73% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███████▍  </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_bad_urls[404] <span class=" -Color -Color-Green">✓</span>                           <span class=" -Color -Color-Green">82% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████████▎ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_bad_urls[500] <span class=" -Color -Color-Green">✓</span>                           <span class=" -Color -Color-Green">91% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████████▏</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> <span class=" -Color -Color-Cyan">test_requests.py</span>::test_bad_urls[501] <span class=" -Color -Color-Green">✓</span>                          <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>

Results (2.83s):
<span class=" -Color -Color-Green">      11 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="running-tests-in-parallel">
<h1>running tests in parallel<a class="headerlink" href="#running-tests-in-parallel" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://pypi.org/project/pytest-xdist/">Reference</a></p>
<p>The <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code> plugin extends pytest with some unique test execution modes:</p>
<ul class="simple">
<li><p><strong>test run parallelization</strong>: if you have multiple CPUs or hosts you can use those for a combined test run. This allows to speed up development or to use special resources of remote machines.</p></li>
<li><p><strong>–looponfail</strong>: run your tests repeatedly in a subprocess. After each run pytest waits until a file in your project changes and then re-runs the previously failing tests. This is repeated until all tests pass after which again a full run is performed.</p></li>
<li><p><strong>Multi-Platform coverage</strong>: you can specify different Python interpreters or different platforms and run tests in parallel on all of them.</p></li>
<li><p><strong>–boxed</strong> and <strong>pytest-forked</strong>: running each test in its own process, so that if a test catastrophically crashes, it doesn’t interfere with other tests</p></li>
</ul>
<p>We’re going to cover only test run parallelization.</p>
<p>first, lets install <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">qq</span> <span class="n">pytest</span><span class="o">-</span><span class="n">xdist</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<p>now, lets write a few long running tests</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_parallel.py

<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">test_t1</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t2</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t3</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t4</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t5</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t6</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t7</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t8</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t9</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_t10</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_parallel.py
</pre></div>
</div>
</div>
</div>
<p>now, we can run these tests in parallel using the <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-n</span> <span class="pre">NUM</span></code> commandline parameter.</p>
<p>Lets use 10 threads, this will allow us to finish in 2 seconds rather than 20</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest -n <span class="m">10</span> test_parallel.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4, timeout-1.4.2, xdist-2.1.0, forked-1.3.0

<span class=" -Color -Color-Bold">gw0 I / gw1 I / gw2 I / gw3 I / gw4 I / gw5 I / gw6 I / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 I / gw2 I / gw3 I / gw4 I / gw5 I / gw6 I / gw7 I / gw8 I / gw9 I</span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 I / gw3 I / gw4 I / gw5 I / gw6 I / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 I / gw4 I / gw5 I / gw6 I / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 I / gw5 I / gw6 I / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 C / gw5 I / gw6 I / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 I / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 I / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 I / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 I</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 C / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 ok / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 C / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 ok / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 C / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 ok / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 C / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 ok / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 C / gw5 C / gw6 C / gw7 C / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 C / gw5 C / gw6 ok / gw7 C / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 ok / gw5 C / gw6 ok / gw7 C / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 ok / gw5 C / gw6 [10] / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 ok / gw5 ok / gw6 [10] / gw7 C / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 ok / gw5 ok / gw6 [10] / gw7 ok / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 ok / gw6 [10] / gw7 ok / gw8 C / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 ok / gw6 [10] / gw7 [10] / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 [10] / gw6 [10] / gw7 [10] / gw8 C / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 [10] / gw6 [10] / gw7 [10] / gw8 ok / gw9 C</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 [10] / gw6 [10] / gw7 [10] / gw8 [10] / gw9 C</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 [10] / gw6 [10] / gw7 [10] / gw8 [10] / gw9 ok</span>
<span class=" -Color -Color-Bold">gw0 [10] / gw1 [10] / gw2 [10] / gw3 [10] / gw4 [10] / gw5 [10] / gw6 [10] / gw7 [10] / gw8 [10] / gw9 [10]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓</span>                                               <span class=" -Color -Color-Green">10% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█         </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓</span>                                             <span class=" -Color -Color-Green">20% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██        </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓</span>                                            <span class=" -Color -Color-Green">30% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███       </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓</span>                                           <span class=" -Color -Color-Green">40% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████      </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓</span>                                          <span class=" -Color -Color-Green">50% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████     </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓</span>                                         <span class=" -Color -Color-Green">60% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████    </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓</span>                                         <span class=" -Color -Color-Green">70% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">███████   </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓</span>                                        <span class=" -Color -Color-Green">80% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">████████  </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓</span>                                       <span class=" -Color -Color-Green">90% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">█████████ </span>
 test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓✓</span>                                     <span class=" -Color -Color-Green">100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">██████████</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results (3.62s):
<span class=" -Color -Color-Green">      10 passed</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="codebase-to-test-class-person">
<h1>Codebase to test: class Person<a class="headerlink" href="#codebase-to-test-class-person" title="Permalink to this headline">¶</a></h1>
<p>Lets reuse the <code class="docutils literal notranslate"><span class="pre">Person</span></code> and <code class="docutils literal notranslate"><span class="pre">OlympicRunner</span></code> classes we’ve defined in earlier chapters in order to see how to write tests</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> person.py

<span class="c1"># Person v1</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">)&quot;</span>
    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;walking&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;running&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">swim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;swimming&#39;</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">OlympicRunner</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;running incredibly fast!&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">show_medals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;showing my olympic medals&#39;</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">person</span><span class="p">):</span>
    <span class="n">person</span><span class="o">.</span><span class="n">walk</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">swim</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting person.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id14">
<h1>our first test<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.pytest.org/en/latest/goodpractices.html#conventions-for-python-test-discovery">conventions</a></p>
<ol class="simple">
<li><p>files with tests should be called <code class="docutils literal notranslate"><span class="pre">test_*.py</span></code> or <code class="docutils literal notranslate"><span class="pre">*_test.py</span> </code></p></li>
<li><p>test function name should start with <code class="docutils literal notranslate"><span class="pre">test_</span></code></p></li>
</ol>
</li>
<li><p>to see if our code works, we can use the <code class="docutils literal notranslate"><span class="pre">assert</span></code> python keyword. pytest adds hooks to assertions to make them more useful</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> test_person1.py
<span class="kn">from</span> <span class="nn">person</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="c1"># our first test</span>
<span class="k">def</span> <span class="nf">test_preson_name</span><span class="p">():</span>
    <span class="n">terry</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Terry Gilliam&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">terry</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Terry Gilliam&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing test_person1.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m pytest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.6, pytest 6.1.1, pytest-sugar 0.9.4)</span>
rootdir: /home/runner/work/learn-python3/learn-python3/learn_python/08_test_driven_development/tdd
plugins: sugar-0.9.4, timeout-1.4.2, xdist-2.1.0, forked-1.3.0
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――― ERROR at setup of test_add_person_exception ――――――――――――――――――
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    <span class=" -Color -Color-White">@pytest</span>.fixture
    def terry():
&gt;       return Person(<span class=" -Color -Color-Yellow">&#39;Terry Gilliam&#39;</span>, <span class=" -Color -Color-Yellow">&#39;blue&#39;</span>, 1940)
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person_fixtures2.py</span>:11: TypeError

                                                                   <span class=" -Color -Color-Green">1% </span><span class=" -Color -Color-BGBlack">▎         </span>

――――――――――――― ERROR at setup of test_add_person_exception_detailed ―――――――――――――

    <span class=" -Color -Color-White">@pytest</span>.fixture
    def terry():
&gt;       return Person(<span class=" -Color -Color-Yellow">&#39;Terry Gilliam&#39;</span>, <span class=" -Color -Color-Yellow">&#39;blue&#39;</span>, 1940)
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person_fixtures2.py</span>:11: TypeError

                                                                   <span class=" -Color -Color-Green">3% </span><span class=" -Color -Color-BGBlack">▍         </span>


 test_add_person_exception.py <span class=" -Color -Color-Green">x</span>                                    <span class=" -Color -Color-Green">4% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">▌         </span>

―――――――――――――――――――――― ERROR at setup of test_add_friend ―――――――――――――――――――――――

    <span class=" -Color -Color-White">@pytest</span>.fixture
    def eric():
&gt;       return Person(<span class=" -Color -Color-Yellow">&#39;Eric Idle&#39;</span>, <span class=" -Color -Color-Yellow">&#39;red&#39;</span>, 1943)
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person_fixtures2.py</span>:7: TypeError

                                                                   <span class=" -Color -Color-Green">5% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">▋         </span>

――――――――――――――――――――――――――――― test_set_comparison ――――――――――――――――――――――――――――――

    def test_set_comparison():
        set1 = set([<span class=" -Color -Color-Yellow">&#39;Apples&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Bananas&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Watermelon&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Pear&#39;</span>,  <span class=" -Color -Color-Yellow">&#39;Guave&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Carambola&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Plum&#39;</span>])
        set2 = set([<span class=" -Color -Color-Yellow">&#39;Plum&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Apples&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Grapes&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Watermelon&#39;</span>,<span class=" -Color -Color-Yellow">&#39;Pear&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Guave&#39;</span>, <span class=" -Color -Color-Yellow">&#39;Carambola&#39;</span>,  <span class=" -Color -Color-Yellow">&#39;Melon&#39;</span> ])
&gt;       assert set1 == set2
<span class=" -Color -Color-Bold -Color-Bold-Red">E       AssertionError: assert {&#39;Apples&#39;, &#39;B..., &#39;Plum&#39;, ...} == {&#39;Apples&#39;, &#39;C..., &#39;Pear&#39;, ...}</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Extra items in the left set:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         &#39;Bananas&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Extra items in the right set:</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         &#39;Grapes&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         &#39;Melon&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E         Use -v to get the full diff</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_compare_fruits.py</span>:4: AssertionError



 test_compare_fruits.py <span class=" -Color -Color-Red">⨯</span>                                          <span class=" -Color -Color-Red">7% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">▊         </span>


 test_fizzbuzz.py <span class=" -Color -Color-Green">✓</span>                                                <span class=" -Color -Color-Red">8% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">▉         </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓</span>                                              <span class=" -Color -Color-Red">10% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">▉         </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓✓</span>                                             <span class=" -Color -Color-Red">11% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▏        </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓✓✓</span>                                            <span class=" -Color -Color-Red">12% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▎        </span>
 test_fizzbuzz.py <span class=" -Color -Color-Green">✓✓✓✓✓</span>                                           <span class=" -Color -Color-Red">14% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▍        </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_http101_timeout.py <span class=" -Color -Color-Green">x</span>                                        <span class=" -Color -Color-Red">15% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▌        </span>


 test_logging.py <span class=" -Color -Color-Green">✓</span>                                                <span class=" -Color -Color-Red">16% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▋        </span>

―――――――――――――――――――――――――― test_logging_warning_fail ―――――――――――――――――――――――――――

    def test_logging_warning_fail():
        logger.warning(<span class=" -Color -Color-Yellow">&#39;\n\n @@@ this WILL be printed @@@ \n\n&#39;</span>)
&gt;       assert False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_logging.py</span>:12: AssertionError
------------------------------ Captured log call -------------------------------
<span class=" -Color -Color-Yellow">WARNING </span> test_logging:test_logging.py:11 

 @@@ this WILL be printed @@@



 test_logging.py <span class=" -Color -Color-Red">⨯</span>                                                <span class=" -Color -Color-Red">18% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▊        </span>

―――――――――――――――――――――――――――― test_logging_info_fail ――――――――――――――――――――――――――――

    def test_logging_info_fail():
        logger.info(<span class=" -Color -Color-Yellow">&#39;\n\n @@@ this will NOT be printed @@@ \n\n&#39;</span>)
&gt;       assert False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_logging.py</span>:16: AssertionError



 test_logging.py <span class=" -Color -Color-Red">⨯</span>                                                <span class=" -Color -Color-Red">19% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▉        </span>


 test_make_triangle.py <span class=" -Color -Color-Green">✓</span>                                          <span class=" -Color -Color-Red">21% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▏       </span>


 test_math.py <span class=" -Color -Color-Green">✓</span>                                                   <span class=" -Color -Color-Red">22% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▎       </span>
 test_math.py <span class=" -Color -Color-Green">✓✓</span>                                                  <span class=" -Color -Color-Red">23% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▍       </span>
 test_math.py <span class=" -Color -Color-Green">✓✓✓</span>                                                 <span class=" -Color -Color-Red">25% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▌       </span>


 test_non_primes.py <span class=" -Color -Color-Green">✓</span>                                             <span class=" -Color -Color-Red">26% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▋       </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓</span>                                            <span class=" -Color -Color-Red">27% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▊       </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓</span>                                           <span class=" -Color -Color-Red">29% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▉       </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓</span>                                          <span class=" -Color -Color-Red">30% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█       </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓</span>                                         <span class=" -Color -Color-Red">32% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▎      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓</span>                                        <span class=" -Color -Color-Red">33% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▍      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓</span>                                       <span class=" -Color -Color-Red">34% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▌      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓</span>                                      <span class=" -Color -Color-Red">36% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▋      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓</span>                                     <span class=" -Color -Color-Red">37% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▊      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓✓</span>                                    <span class=" -Color -Color-Red">38% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▉      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓✓✓</span>                                   <span class=" -Color -Color-Red">40% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██      </span>
 test_non_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓✓✓✓</span>                                  <span class=" -Color -Color-Red">41% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▎     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓</span>                                               <span class=" -Color -Color-Red">42% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▎     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓</span>                                              <span class=" -Color -Color-Red">44% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▍     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓</span>                                             <span class=" -Color -Color-Red">45% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▌     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓</span>                                            <span class=" -Color -Color-Red">47% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▋     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓</span>                                           <span class=" -Color -Color-Red">48% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▊     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓</span>                                          <span class=" -Color -Color-Red">49% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">██▉     </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓</span>                                         <span class=" -Color -Color-Red">51% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▏    </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓</span>                                        <span class=" -Color -Color-Red">52% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▎    </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓</span>                                       <span class=" -Color -Color-Red">53% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▍    </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_parallel.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓✓</span>                                      <span class=" -Color -Color-Red">55% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███▌    </span>

―――――――――――――――――――――――――――――――――― test_name ―――――――――――――――――――――――――――――――――――

    def test_name():
        # setup
&gt;       terry = Person(
            <span class=" -Color -Color-Yellow">&#39;Terry Gilliam&#39;</span>,
            <span class=" -Color -Color-Yellow">&#39;red&#39;</span>,
            1940
            )
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person.py</span>:6: TypeError



 test_person.py <span class=" -Color -Color-Red">⨯</span>                                                 <span class=" -Color -Color-Red">56% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">▋    </span>

――――――――――――――――――――――――――――――― test_add_friend ――――――――――――――――――――――――――――――――

    def test_add_friend():
        # setup for the test
&gt;       terry = Person(
            <span class=" -Color -Color-Yellow">&#39;Terry Gilliam&#39;</span>,
            <span class=" -Color -Color-Yellow">&#39;red&#39;</span>,
            1940
            )
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person.py</span>:18: TypeError



 test_person.py <span class=" -Color -Color-Red">⨯</span>                                                 <span class=" -Color -Color-Red">58% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">▊    </span>

――――――――――――――――――――――――――――――― test_preson_name ―――――――――――――――――――――――――――――――

    def test_preson_name():
        terry = Person(<span class=" -Color -Color-Yellow">&#39;Terry Gilliam&#39;</span>)
&gt;       assert terry.name == <span class=" -Color -Color-Yellow">&#39;Terry Gilliam&#39;</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E       AttributeError: &#39;Person&#39; object has no attribute &#39;name&#39;</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person1.py</span>:6: AttributeError



 test_person1.py <span class=" -Color -Color-Red">⨯</span>                                                <span class=" -Color -Color-Red">59% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">▉    </span>

――――――――――――――――――――――――――――――― test_person_name ―――――――――――――――――――――――――――――――

person_name = &#39;Terry Gilliam&#39;, favorite_color = &#39;red&#39;, birth_year = 1940

    def test_person_name(person_name, favorite_color, birth_year):
&gt;       person = Person(person_name, favorite_color, birth_year)
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person_fixtures1.py</span>:18: TypeError



 test_person_fixtures1.py <span class=" -Color -Color-Red">⨯</span>                                       <span class=" -Color -Color-Red">60% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█    </span>

―――――――――――――――――――――― ERROR at setup of test_add_friend ―――――――――――――――――――――――

    <span class=" -Color -Color-White">@pytest</span>.fixture
    def eric():
&gt;       return Person(<span class=" -Color -Color-Yellow">&#39;Eric Idle&#39;</span>, <span class=" -Color -Color-Yellow">&#39;red&#39;</span>, 1943)
<span class=" -Color -Color-Bold -Color-Bold-Red">E       TypeError: __init__() takes 2 positional arguments but 4 were given</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_person_fixtures2.py</span>:7: TypeError

                                                                  <span class=" -Color -Color-Red">62% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▎   </span>


 test_primes.py <span class=" -Color -Color-Green">✓</span>                                                 <span class=" -Color -Color-Red">63% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▍   </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓</span>                                                <span class=" -Color -Color-Red">64% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▌   </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓</span>                                               <span class=" -Color -Color-Red">66% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▋   </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓✓</span>                                              <span class=" -Color -Color-Red">67% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▊   </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓</span>                                             <span class=" -Color -Color-Red">68% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▉   </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓</span>                                            <span class=" -Color -Color-Red">70% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█   </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓</span>                                           <span class=" -Color -Color-Red">71% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▎  </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓</span>                                          <span class=" -Color -Color-Red">73% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▍  </span>
 test_primes.py <span class=" -Color -Color-Green">✓✓✓✓✓✓✓✓✓</span>                                         <span class=" -Color -Color-Red">74% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▌  </span>


 test_prints.py <span class=" -Color -Color-Green">✓</span>                                                 <span class=" -Color -Color-Red">75% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█▌  </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――――――――――――――――― test_print_fail ――――――――――――――――――――――――――――――――

    def test_print_fail():
    
        print(
            <span class=" -Color -Color-Yellow">&quot;&quot;&quot;</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        this statement WILL be printed</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        &quot;&quot;&quot;</span>
        )
&gt;       assert True == False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert True == False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_prints.py</span>:23: AssertionError
----------------------------- Captured stdout call -----------------------------

        @@@@@@@@@@@@@@@
        this statement WILL be printed
        @@@@@@@@@@@@@@@
        



 test_prints.py <span class=" -Color -Color-Red">⨯</span>                                                 <span class=" -Color -Color-Red">77% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">▋  </span>
 test_prints.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓</span>                                                <span class=" -Color -Color-Red">78% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">▊  </span>

――――――――――――――――――――――――――― test_stderr_capture_fail ―――――――――――――――――――――――――――

    def test_stderr_capture_fail():
        print(
            <span class=" -Color -Color-Yellow">&quot;&quot;&quot;</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        this STDERR statement WILL be printed</span>
    <span class=" -Color -Color-Yellow">        @@@@@@@@@@@@@@@</span>
    <span class=" -Color -Color-Yellow">        &quot;&quot;&quot;</span>,
            file=sys.stderr
        )
    
&gt;       assert False
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert False</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_prints.py</span>:49: AssertionError
----------------------------- Captured stderr call -----------------------------

        @@@@@@@@@@@@@@@
        this STDERR statement WILL be printed
        @@@@@@@@@@@@@@@
        



 test_prints.py <span class=" -Color -Color-Red">⨯</span>                                                 <span class=" -Color -Color-Red">79% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">▉  </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Green">✓</span>                                               <span class=" -Color -Color-Red">81% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▏ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Green">✓✓</span>                                              <span class=" -Color -Color-Red">82% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▎ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Green">✓✓✓</span>                                             <span class=" -Color -Color-Red">84% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">▍ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――――――――――――――― test_good_urls[203] ――――――――――――――――――――――――――――――

good_url = &#39;http://httpstat.us/203&#39;

    <span class=" -Color -Color-White">@pytest</span>.mark.timeout(2)
    def test_good_urls(good_url):
&gt;       response = requests.get(good_url)

<span class=" -Color -Color-Bold -Color-Bold-Red">test_requests.py</span>:15: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/api.py</span>:76: in get
    return request(<span class=" -Color -Color-Yellow">&#39;get&#39;</span>, url, params=params, **kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/api.py</span>:61: in request
    return session.request(method=method, url=url, **kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/sessions.py</span>:530: in request
    resp = self.send(prep, **send_kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/sessions.py</span>:643: in send
    r = adapter.send(request, **kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/adapters.py</span>:439: in send
    resp = conn.urlopen(
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/urllib3/connectionpool.py</span>:670: in urlopen
    httplib_response = self._make_request(
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/urllib3/connectionpool.py</span>:426: in _make_request
    six.raise_from(e, None)
<span class=" -Color -Color-Bold -Color-Bold-Red">&lt;string&gt;</span>:3: in raise_from
    ???
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/urllib3/connectionpool.py</span>:421: in _make_request
    httplib_response = conn.getresponse()
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/http/client.py</span>:1347: in getresponse
    response.begin()
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/http/client.py</span>:307: in begin
    version, status, reason = self._read_status()
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/http/client.py</span>:268: in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), <span class=" -Color -Color-Yellow">&quot;iso-8859-1&quot;</span>)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;socket.SocketIO object at 0x7fb2e08afc40&gt;
b = &lt;memory at 0x7fb2e11b9e80&gt;

    def readinto(self, b):
        <span class=" -Color -Color-Yellow">&quot;&quot;&quot;Read up to len(b) bytes into the writable buffer *b* and return</span>
    <span class=" -Color -Color-Yellow">    the number of bytes read.  If the socket is non-blocking and no bytes</span>
    <span class=" -Color -Color-Yellow">    are available, None is returned.</span>
    
    <span class=" -Color -Color-Yellow">    If *b* is non-empty, a 0 return value indicates that the connection</span>
    <span class=" -Color -Color-Yellow">    was shutdown at the other end.</span>
    <span class=" -Color -Color-Yellow">    &quot;&quot;&quot;</span>
        self._checkClosed()
        self._checkReadable()
        if self._timeout_occurred:
            raise OSError(<span class=" -Color -Color-Yellow">&quot;cannot read from timed out object&quot;</span>)
        while True:
            try:
&gt;               return self._sock.recv_into(b)
<span class=" -Color -Color-Bold -Color-Bold-Red">E               Failed: Timeout &gt;2.0s</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/socket.py</span>:669: Failed



 test_requests.py <span class=" -Color -Color-Red">⨯</span>                                               <span class=" -Color -Color-Red">85% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▌ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓</span>                                              <span class=" -Color -Color-Red">86% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▋ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓✓</span>                                             <span class=" -Color -Color-Red">88% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▊ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓✓✓</span>                                            <span class=" -Color -Color-Red">89% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█▉ </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓✓✓✓</span>                                           <span class=" -Color -Color-Red">90% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▏</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>―――――――――――――――――――――――――――――― test_bad_urls[404] ――――――――――――――――――――――――――――――

bad_url = &#39;http://httpstat.us/404&#39;

    <span class=" -Color -Color-White">@pytest</span>.mark.timeout(2)
    def test_bad_urls(bad_url):
&gt;       response = requests.get(bad_url)

<span class=" -Color -Color-Bold -Color-Bold-Red">test_requests.py</span>:20: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/api.py</span>:76: in get
    return request(<span class=" -Color -Color-Yellow">&#39;get&#39;</span>, url, params=params, **kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/api.py</span>:61: in request
    return session.request(method=method, url=url, **kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/sessions.py</span>:530: in request
    resp = self.send(prep, **send_kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/sessions.py</span>:643: in send
    r = adapter.send(request, **kwargs)
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/requests/adapters.py</span>:439: in send
    resp = conn.urlopen(
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/urllib3/connectionpool.py</span>:670: in urlopen
    httplib_response = self._make_request(
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/urllib3/connectionpool.py</span>:426: in _make_request
    six.raise_from(e, None)
<span class=" -Color -Color-Bold -Color-Bold-Red">&lt;string&gt;</span>:3: in raise_from
    ???
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/site-packages/urllib3/connectionpool.py</span>:421: in _make_request
    httplib_response = conn.getresponse()
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/http/client.py</span>:1347: in getresponse
    response.begin()
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/http/client.py</span>:307: in begin
    version, status, reason = self._read_status()
<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/http/client.py</span>:268: in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), <span class=" -Color -Color-Yellow">&quot;iso-8859-1&quot;</span>)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;socket.SocketIO object at 0x7fb2e070cac0&gt;
b = &lt;memory at 0x7fb2e106fc40&gt;

    def readinto(self, b):
        <span class=" -Color -Color-Yellow">&quot;&quot;&quot;Read up to len(b) bytes into the writable buffer *b* and return</span>
    <span class=" -Color -Color-Yellow">    the number of bytes read.  If the socket is non-blocking and no bytes</span>
    <span class=" -Color -Color-Yellow">    are available, None is returned.</span>
    
    <span class=" -Color -Color-Yellow">    If *b* is non-empty, a 0 return value indicates that the connection</span>
    <span class=" -Color -Color-Yellow">    was shutdown at the other end.</span>
    <span class=" -Color -Color-Yellow">    &quot;&quot;&quot;</span>
        self._checkClosed()
        self._checkReadable()
        if self._timeout_occurred:
            raise OSError(<span class=" -Color -Color-Yellow">&quot;cannot read from timed out object&quot;</span>)
        while True:
            try:
&gt;               return self._sock.recv_into(b)
<span class=" -Color -Color-Bold -Color-Bold-Red">E               Failed: Timeout &gt;2.0s</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">/opt/hostedtoolcache/Python/3.8.6/x64/lib/python3.8/socket.py</span>:669: Failed



 test_requests.py <span class=" -Color -Color-Red">⨯</span>                                               <span class=" -Color -Color-Red">92% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▎</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓</span>                                              <span class=" -Color -Color-Red">93% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▍</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> test_requests.py <span class=" -Color -Color-Red">⨯</span><span class=" -Color -Color-Green">✓✓</span>                                             <span class=" -Color -Color-Red">95% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▌</span>


 test_sin.py <span class=" -Color -Color-Green">✓</span>                                                    <span class=" -Color -Color-Red">96% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▋</span>


 test_spanish_inquisition.py <span class=" -Color -Color-Green">✓</span>                                    <span class=" -Color -Color-Red">97% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">██</span><span class=" -Color -Color-Green -Color-Green-BGBlack">███</span><span class=" -Color -Color-Red -Color-Red-BGBlack">█</span><span class=" -Color -Color-Green -Color-Green-BGBlack">█</span><span class=" -Color -Color-Red -Color-Red-BGBlack">██▊</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lets-run-our-tests">
<h2>lets run our tests<a class="headerlink" href="#lets-run-our-tests" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># execute the tests via pytest, arguments are passed to pytest</span>
<span class="n">ipytest</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;-qq&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR: file not found: adv python 08 - test driven development.ipynb
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="running-our-first-test">
<h2>running our first test<a class="headerlink" href="#running-our-first-test" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># very simple test</span>
<span class="k">def</span> <span class="nf">test_person_repr1</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="s1">&#39;terry gilliam&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;Person(&#39;terry gilliam&#39;)&quot;</span>

<span class="c1"># test using mock object</span>
<span class="k">def</span> <span class="nf">test_train1</span><span class="p">():</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">mocking</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
    
    <span class="n">train</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="n">person</span><span class="o">.</span><span class="n">walk</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">swim</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

<span class="c1"># create factory for person&#39;s name</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">person_name</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;terry gilliam&#39;</span>
    
<span class="c1"># create factory for Person, that requires a person_name </span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">person</span><span class="p">(</span><span class="n">person_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Person</span><span class="p">(</span><span class="n">person_name</span><span class="p">)</span>

<span class="c1"># test using mock object</span>
<span class="k">def</span> <span class="nf">test_train2</span><span class="p">(</span><span class="n">person</span><span class="p">):</span>
    <span class="c1"># this makes sure no other method is called</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">mocking</span><span class="o">.</span><span class="n">create_autospec</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    
    <span class="n">train</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="n">person</span><span class="o">.</span><span class="n">walk</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
    <span class="n">person</span><span class="o">.</span><span class="n">swim</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>


<span class="c1"># test Person using and request a person, person_name from the fixtures</span>
<span class="k">def</span> <span class="nf">test_person_repr2</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">person_name</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">person</span><span class="p">)</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;Person(&#39;</span><span class="si">{</span><span class="n">person_name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
    
<span class="c1"># fixture with multiple values</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;usain bolt&#39;</span><span class="p">,</span> <span class="s1">&#39;Matthew Wells&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">olympic_runner_name</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">olympic_runner</span><span class="p">(</span><span class="n">olympic_runner_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">OlympicRunner</span><span class="p">(</span><span class="n">olympic_runner_name</span><span class="p">)</span>

<span class="c1"># test train() using mock object for print</span>
<span class="nd">@mocking</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.print&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_train3</span><span class="p">(</span><span class="n">mocked_print</span><span class="p">,</span> <span class="n">olympic_runner</span><span class="p">):</span>
    <span class="n">train</span><span class="p">(</span><span class="n">olympic_runner</span><span class="p">)</span>
    <span class="n">mocked_print</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># execute the tests via pytest, arguments are passed to pytest</span>
<span class="n">ipytest</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;-qq&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>......                                                                                                           [100%]
</pre></div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./08_test_driven_development"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../07_design_patterns_in_python/07-design_patterns_in_python.html" title="previous page">Design patterns in python</a>
    <a class='right-next' id="next-link" href="08-unittest_mock.html" title="next page">&lt;no title&gt;</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Aviad Rozenhek<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>